<?php

declare(strict_types=1);

class DiscordExtension extends Minz_Extension {

    #[\Override]
    public function init(): void {
        $this->registerTranslates();
        $this->registerHook("entry_before_insert", [$this, "handleEntryBeforeInsert"]);
    }

    public function handleConfigureAction(): void {
      $this->registerTranslates();

			if (Minz_Request::isPost()) {
				$now = new DateTime();
				$test = Minz_Request::hasParam("test");
				$config = [
					"url" => Minz_Request::paramString("url"),
					"username" => Minz_Request::paramString("username"),
					"avatar_url" => Minz_Request::paramString("avatar_url")
				];

				$this->setSystemConfiguration($config);

				$sample = "<table border=0 cellpadding=0 cellspacing=0 align=\"center\" border=\"0\"> <tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"> <div> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr> <td align=\"left\" style=\"padding-left: 4px; font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"><p>#\u200B710 \u2014 October 24, 2024</p></td> <td align=\"right\" style=\"padding-right: 4px; font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"><p><a href=\"https://javascriptweekly.com/link/161397/rss\" style=\" color: #3366aa;\">Read on the Web</a></p></td> </tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\" font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0; padding-right: 12px; padding-left: 12px;\"><p>JavaScript Weekly</p></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"> <a href=\"https://javascriptweekly.com/link/161451/rss\" style=\" color: #3366aa;\"><img src=\"https://res.cloudinary.com/cpress/image/upload/w_1280,e_sharpen:60,q_auto/nzdnecxa3eqexjde35fv.jpg\" width=\"640\" style=\" line-height: 100%; \"></a> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161451/rss\" title=\"svelte.dev\" style=\" color: #3366aa; font-size: 1.1em; line-height: 1.4em;\">Svelte 5 is Alive</a></span> \u2014 The long awaited next major release of <a href=\"https://javascriptweekly.com/link/161452/rss\" style=\" color: #3366aa; \">Svelte</a>, the compiler-driven JS UI framework, is the <em>\u201Cmost significant release in the project\u2019s history\u201D</em>, while remaining largely backwards compatible. A big addition is <em>runes</em> for explicitly declaring reactive state, but there\u2019s <a href=\"https://javascriptweekly.com/link/161453/rss\" style=\" color: #3366aa; \">much more besides.</a> The official <a href=\"https://javascriptweekly.com/link/161452/rss\" style=\" color: #3366aa; \">svelte.dev</a> site has also <a href=\"https://javascriptweekly.com/link/161454/rss\" style=\" color: #3366aa; \">undergone a big rebuild</a> to act as an \u2018omnisite\u2019 for all things Svelte.</p> <p>The Svelte Team </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"><p>\uD83D\uDCFA If you want to see <em>how</em> to use Svelte 5, <em>Syntax</em>'s Scott Tolinski has released <a href=\"https://javascriptweekly.com/link/161456/rss\" style=\" color: #3366aa; font-weight: 600;\">\u25B6\uFE0F a 2 hour Svelte 5 basics course</a> on YouTube.</p></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <a href=\"https://javascriptweekly.com/link/161398/rss\" style=\" color: #3366aa; \"><img src=\"https://copm.s3.amazonaws.com/9fbdb0ce.png\" width=\"148\" height=\"110\" style=\"padding-top: 12px; padding-left: 12px; line-height: 100%; \"></a> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161398/rss\" title=\"developer.mescius.com\" style=\" color: #3366aa; font-size: 1.05em;\">FlexGrid by Wijmo: The Industry-Leading JavaScript Datagrid</a></span> \u2014 A fast and flexible DataGrid for building modern web apps. Key features and virtualized rendering are included in the grid module. Pick and choose special features to keep your app small. Built for JavaScript, extended to Angular, React, and Vue.</p> <p>Wijmo From MESCIUS inc <span style=\"text-transform: uppercase; margin-left: 4px; font-size: 0.9em; color: #993 !important; padding-top: 1px; padding-right: 4px; padding-left: 4px; \">sponsor</span></p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161399/rss\" title=\"microsoft.github.io\" style=\" color: #3366aa; font-size: 1.05em;\">GenAIScript: Microsoft's Generative AI Scripting Environment</a></span> \u2014 Microsoft is really poking at AI from all angles. <a href=\"https://javascriptweekly.com/link/161400/rss\" style=\" color: #3366aa; \">TypeChat</a> introduced a type-safe way to talk to LLMs; now <em>GenAIScript</em> offers a JavaScript-powered way to programmatically assemble prompts and process responses. They claim it <em>\u201Cbrings essential LLM prompt tooling into a cohesive scripting environment.\u201D</em></p> <p>Microsoft </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161458/rss\" title=\"nextjs.org\" style=\" color: #3366aa; font-size: 1.05em;\">Next.js 15 Released</a></span> \u2014 It\u2019s a big week for the popular (some may even argue <em>default</em>) React framework with <a href=\"https://javascriptweekly.com/link/161459/rss\" style=\" color: #3366aa; \">Next.js Conf</a> starting today, as well as this release. It includes a codemod CLI for easier upgrading, async request APIs, alignment with React 19, and more.</p> <p>Vercel </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><strong>IN BRIEF:</strong></p> <ul> <li> <p>Developer IDE firm <em>JetBrains</em> has announced its <a href=\"https://javascriptweekly.com/link/161401/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">WebStorm JavaScript/TypeScript IDE</a> is <a href=\"https://javascriptweekly.com/link/161402/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">now free for non-commercial use</a> which, notably, also covers paid content creators.</p> </li> <li> <p>The popular <code>shadcn/ui</code> component library has <a href=\"https://javascriptweekly.com/link/161403/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">unveiled a new suite of components for building <em>sidebars.</em></a></p> </li> <li> <p>\u231A <a href=\"https://javascriptweekly.com/link/161404/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Spectra</a> is a hackable smartwatch seeking funding on Kickstarter (but it has passed its initial goal). ESP32-S3 based, it appears able to run JavaScript as shown in the 'dev experience' screenshots.</p> </li> <li> <p>\uD83D\uDE4B This year's <a href=\"https://javascriptweekly.com/link/161405/rss\" style=\" color: #3366aa; font-weight: 500 !important; \"><em>State of React</em> survey</a> is now open to take until November 19.</p> </li> </ul> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><strong>RELEASES:</strong></p> <ul> <li> <p>\u269B\uFE0F <a href=\"https://javascriptweekly.com/link/161406/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">React Native 0.76</a> \u2013 A <em>big</em> release. The so-called <a href=\"https://javascriptweekly.com/link/161407/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">'New Architecture' is now used by default</a> (so you can now use all the modern React features in RN too), the React Native DevTools are stable, and build times are faster than ever.</p> </li> <li> <p>\uD83E\uDD56 <a href=\"https://javascriptweekly.com/link/161408/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Bun</a> is on a <em>roll..</em> with three releases in the past week. <a href=\"https://javascriptweekly.com/link/161409/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">v1.1.31</a> added support for <code>node:http2</code> server and gRPC, <a href=\"https://javascriptweekly.com/link/161410/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">v1.1.32</a> added Node's <code>crypto.hash</code> method, and <a href=\"https://javascriptweekly.com/link/161411/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">v1.1.33</a> was a bug-fix release.</p> </li> <li> <p><a href=\"https://javascriptweekly.com/link/161412/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Express.js 5.0</a> \u2013 Landed a few weeks ago, but now there's an official post explaining the state of the project which has now <a href=\"https://javascriptweekly.com/link/161413/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">passed a comprehensive third party security audit.</a></p> </li> <li> <p><a href=\"https://javascriptweekly.com/link/161414/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Medusa 2.0</a> \u2013 A Node.js-powered ecommerce platform.</p> </li> <li> <p><a href=\"https://javascriptweekly.com/link/161460/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">React Compiler Beta</a>, <a href=\"https://javascriptweekly.com/link/161461/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Turborepo 2.2</a>, <a href=\"https://javascriptweekly.com/link/161415/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">ESLint v9.13.0</a>, <a href=\"https://javascriptweekly.com/link/161416/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Deno 2.0.2</a></p> </li> </ul> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0; padding-right: 0; padding-left: 0;\"><p>\uD83D\uDCD2 Articles &amp; Tutorials</p></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"> <a href=\"https://javascriptweekly.com/link/161417/rss\" style=\" color: #3366aa;\"><img src=\"https://res.cloudinary.com/cpress/image/upload/w_1280,e_sharpen:60,q_auto/e9a7ywholj8fhzmln8cb.jpg\" width=\"640\" style=\" line-height: 100%; \"></a> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\">\u25B6  <a href=\"https://javascriptweekly.com/link/161417/rss\" title=\"www.youtube.com\" style=\" color: #3366aa; font-size: 1.05em;\">Build a Sonic Infinite Runner Game Using Kaplay</a></span> \u2014 A two hour walkthrough of using the <a href=\"https://javascriptweekly.com/link/161418/rss\" style=\" color: #3366aa; \">Kaplay</a> game library (formerly known as <em>Kaboom.js</em>) to build a complete, if simple, Sonic-branded game. You can also <a href=\"https://javascriptweekly.com/link/161419/rss\" style=\" color: #3366aa; \">play it here.</a></p> <p>JSLegendDev </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161420/rss\" title=\"wallabyjs.com\" style=\" color: #3366aa; font-size: 1.05em;\">New Wallaby 2.0 - Works with All Editors - A Massive Step Forward for JavaScript Testing</a></span> \u2014 Experience faster JavaScript debugging, real-time insights, &amp; enhanced coverage monitoring with Wallaby 2.0's integrated UI.</p> <p>Wallaby Team <span style=\"text-transform: uppercase; margin-left: 4px; font-size: 0.9em; color: #993 !important; padding-top: 1px; padding-right: 4px; padding-left: 4px; \">sponsor</span></p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161421/rss\" title=\"nolanlawson.com\" style=\" color: #3366aa; font-size: 1.05em;\">Why I\u2019m Skeptical of Rewriting JavaScript Tools in \u201CFaster\u201D Languages</a></span> \u2014 Rewriting common JS infrastructure / build tools in \u2018faster\u2019 languages like Rust, Zig or Go has become popular in recent years, but is it necessary, asks Nolan?</p> <p>Nolan Lawson </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161422/rss\" title=\"www.thedevspace.io\" style=\" color: #3366aa; font-size: 1.05em;\">How to Create a Modern SPA with Django and Vue</a></span> \u2014 If you can handle some Python in your life, <a href=\"https://javascriptweekly.com/link/161423/rss\" style=\" color: #3366aa; \">Django</a> is a powerful backend web framework and it\u2019s quite happy to be paired up with a Vue.js frontend with GraphQL providing the glue.</p> <p>The Dev Space </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161424/rss\" title=\"go.clerk.com\" style=\" color: #3366aa; font-size: 1.05em;\">Learn How to Build a Full Stack Application Using React Native &amp; Expo</a></span> \u2014 Build a cross-platform full-stack app using a single codebase with scalable backend support and authentication.</p> <p>Clerk <span style=\"text-transform: uppercase; margin-left: 4px; font-size: 0.9em; color: #993 !important; padding-top: 1px; padding-right: 4px; padding-left: 4px; \">sponsor</span></p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p>\uD83D\uDCC4 <a href=\"https://javascriptweekly.com/link/161425/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Creating a 3D Hand Controller Using a Webcam, MediaPipe and Three.js</a> <cite>Caio Bassetti</cite></p> <p>\uD83D\uDCC4 <a href=\"https://javascriptweekly.com/link/161426/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">How To Speed Up Your Vue App with Server Side Rendering</a> <cite>Jakub Andrzejewski</cite></p> <p>\uD83D\uDCC4 <a href=\"https://javascriptweekly.com/link/161427/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Angular\u2019s Approach to Partial Hydration</a> <cite>Loraine Lawson (The New Stack)</cite></p> <p>\uD83D\uDCC4 <a href=\"https://javascriptweekly.com/link/161428/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Understanding <code>npm audit</code> and Fixing Vulnerabilities</a> <cite>Niraj Chauhan</cite></p> <p>\uD83D\uDCC4 <a href=\"https://javascriptweekly.com/link/161429/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Building a Mental Model of Node.js Streams</a> <cite>Pavel Romanov</cite></p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0; padding-right: 0; padding-left: 0;\"><p>\uD83D\uDEE0 Code &amp; Tools</p></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"> <a href=\"https://javascriptweekly.com/link/161430/rss\" style=\" color: #3366aa;\"><img src=\"https://res.cloudinary.com/cpress/image/upload/w_1280,e_sharpen:60,q_auto/fvdujbug4opoda57kyli.jpg\" width=\"640\" style=\" line-height: 100%; \"></a> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161430/rss\" title=\"github.com\" style=\" color: #3366aa; font-size: 1.05em;\">match-sorter 7.0: Deterministic Best-Match Array Sorting</a></span> \u2014 If you have an array of items you want to filter and sort \u2018intelligently\u2019 and deterministically, this offers a well-described, predictable algorithm. Play with <a href=\"https://javascriptweekly.com/link/161431/rss\" style=\" color: #3366aa; \">a live CodeSandbox demo.</a></p> <p>Kent C. Dodds </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><span>\uD83E\uDD16</span> <a href=\"https://javascriptweekly.com/link/161462/rss\" title=\"huggingface.co\" style=\" color: #3366aa; font-size: 1.05em;\">Transformers.js v3: Run Transformers in the Browser</a></span> \u2014 A JS port of Hugging Face\u2019s <code>transformers</code> Python library that can run natural language, vision, and audio machine learning models right in the browser. v3 adds WebGPU support for boosted performance and now supports Node, Deno and Bun too.</p> <p>Hugging Face </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161433/rss\" title=\"\" style=\" color: #3366aa; font-size: 1.05em;\">Build Forms from JSON Using Drag &amp; Drop UI \u2014 SurveyJS Libraries for Surveys &amp; Forms</a></span> \u2014 Integrate a JSON form editor with any backend. Enjoy complete control over your data with unlimited users and forms \u2014 no restrictions.</p> <p>SurveyJS <span style=\"text-transform: uppercase; margin-left: 4px; font-size: 0.9em; color: #993 !important; padding-top: 1px; padding-right: 4px; padding-left: 4px; \">sponsor</span></p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161432/rss\" title=\"www.wheresrhys.co.uk\" style=\" color: #3366aa; font-size: 1.05em;\">Fetch Mock 12.0: Mock Requests by the <code>fetch</code> API</a></span> \u2014 A flexible API for mocking HTTP requests made by <code>fetch</code> or fetch-imitating libraries. Supports browsers, Node, and web/service workers.</p> <p>Rhys Evans </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><span>\uD83D\uDCCA</span> <a href=\"https://javascriptweekly.com/link/161434/rss\" title=\"lib.vizzuhq.com\" style=\" color: #3366aa; font-size: 1.05em;\">Vizzu 0.14: A Library for <em>Animated</em> Data Visualizations</a></span> \u2014 Making visualizations is one thing; animating them is much harder. Vizzu helps you create animated data stories and interactive explorers with a variety of <a href=\"https://javascriptweekly.com/link/161435/rss\" style=\" color: #3366aa; \">showcase examples</a> for inspiration.</p> <p>Vizzu Inc. </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161437/rss\" title=\"github.com\" style=\" color: #3366aa; font-size: 1.05em;\">eslint-plugin-functional: Rules to Promote Functional Programming</a></span> \u2014 This isn\u2019t for <em>me</em>, but if you want to encourage (or even force) a lack of mutation and a use of FP techniques in your codebase, this could be for <em>you.</em></p> <p>Jonas Kello </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><span style=\"font-weight: 600; font-size: 1.1em; color: #000;\"><a href=\"https://javascriptweekly.com/link/161438/rss\" title=\"www.radix-vue.com\" style=\" color: #3366aa; font-size: 1.05em;\">Radix Vue: Unstyled, Accessible Components for Vue.js</a></span> \u2014 An unofficial Vue port of the popular <a href=\"https://javascriptweekly.com/link/161439/rss\" style=\" color: #3366aa; \">Radix UI</a> component library. <a href=\"https://javascriptweekly.com/link/161440/rss\" style=\" color: #3366aa; \">GitHub repo.</a></p> <p>zernonia et al. </p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <ul> <li> <p><a href=\"https://javascriptweekly.com/link/161441/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Edge.js v23</a> \u2013 Run .NET and Node.js code in one process on Windows, macOS and Linux.</p> </li> <li> <p>\u2702\uFE0F <a href=\"https://javascriptweekly.com/link/161442/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Knip 5.34.0</a> \u2013 A neat way to find and tidy unused stuff in your projects.</p> </li> <li> <p>\uD83E\uDDCA <a href=\"https://javascriptweekly.com/link/161443/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">PlayCanvas glTF Viewer 5.0</a> \u2013 3D model viewer supporting glTF 2.0 and PLY.</p> </li> <li> <p>\uD83D\uDDD3\uFE0F <a href=\"https://javascriptweekly.com/link/161444/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">React Date Picker 7.5</a> \u2013 Simple date picker component. (<a href=\"https://javascriptweekly.com/link/161445/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Demo</a>.)</p> </li> <li> <p>\uD83E\uDD16 <a href=\"https://javascriptweekly.com/link/161446/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">ml.js 8.0</a> \u2013 Machine learning tools in JavaScript.</p> </li> <li> <p><a href=\"https://javascriptweekly.com/link/161447/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">MDX 3.1</a> \u2013 Write JSX in your Markdown documents.</p> </li> </ul> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\" font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 0px; padding-left: 0px;\"> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\" font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"></td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p>\uD83D\uDCF0 Classifieds</p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\"font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; padding-top: 0px; padding-right: 15px; padding-left: 15px;\"> <p><a href=\"https://javascriptweekly.com/link/161448/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Meticulous automatically creates &amp; maintains E2E UI tests</a>. Zero flakes. Used by Lattice, Bilt Rewards and others.</p> <p><a href=\"https://javascriptweekly.com/link/161449/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">SupaHooks</a>: An Outbound Webhooks Template for Next.js.</p> <p>\u2699\uFE0F Create entire web apps with <a href=\"https://javascriptweekly.com/link/161450/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Reactile</a> and let it handle your widgets and windows within a single browser tab. 1-month free trial. <a href=\"https://javascriptweekly.com/link/161450/rss\" style=\" color: #3366aa; font-weight: 500 !important; \">Try it now</a>.</p> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\" font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"></td></tr></table> </td></tr></table> <table border=0 cellpadding=0 cellspacing=0 border=0 cellpadding=0 cellspacing=0><tr><td style=\" font-family: -apple-system,BlinkMacSystemFont,Helvetica,sans-serif; font-size: 15px; line-height: 1.48em; \"></td></tr></table> </div> </td></tr> </table> <img src=\"https://javascriptweekly.com/open/710/rss\" width=\"1\" height=\"1\" />";

				if ($test) {
					$this->sendMessage(
						$config["url"],
						$config["username"],
						$config["avatar_url"],
						[
							"content" => $this->truncate($this->sanitize($sample), 2000)
							//"content" => "Test message from FreshRSS posted at " . $now->format('m/d/Y H:i:s')
						]
					);
				}
			}
  }

	public function handleEntryBeforeInsert($entry) {
		$thumbnail = $entry->thumbnail();
		$description = $this->sanitize($entry->originalContent());

		$this->sendMessage(
			$this->getSystemConfigurationValue("url"),
			$this->getSystemConfigurationValue("username"),
			$this->getSystemConfigurationValue("avatar_url"),
			[
				"embeds" => [
					[
						"title" => $entry->title(),
						"url" => $entry->link(),
						"color" => 2605643,
						"description" => $this->truncate($description, 2000),
						"timestamp" => (new DateTime('@'. $entry->date(true)/1000))->format(DateTime::ATOM),
						"author" => [
							"name" => $entry->feed()->name(),
							"icon_url" => $this->getSystemConfigurationValue("avatar_url") // Would love this to be feed icon
						],
						"thumbnail" => isset($thumbnail) ? [
							"url" => $thumbnail["url"],
							"width" => $thumbnail["width"] ?? null,
							"height" => $thumbnail["height"] ?? null,
						] : null
					]
				]
			]
		);

		return $entry;
	}

	public function sendMessage($url, $username, $avatar_url, $body) {
		try {
			$ch = curl_init($url);
			$data = [
				"username" => $username,
				"avatar_url" => $avatar_url,
			];

			if(isset($body["content"])) {
				$data["content"] = $body["content"];
			}

			if(isset($body["embeds"])) {
				$data["embeds"] = $body["embeds"];
			}

			curl_setopt($ch, CURLOPT_POST, 1);
			curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
			curl_setopt($ch, CURLOPT_HTTPHEADER, ["Content-Type: application/json"]);
			curl_exec($ch);
		} catch (Throwable $err) {
			Minz_Log::error("[Discord] ❌ " . $err);
		} finally {
			curl_close($ch);
		}
	}

	public function truncate(string $text, int $length = 20): string {
		if (strlen($text) <= $length) {
			return $text;
		}

		$text = substr($text, 0, $length);
		$text = substr($text, 0, strrpos($text, " "));
		$text .= "...";

		return $text;
	}

	public function sanitize(string $text): string {
    // Remove spaces between tags
    $text = preg_replace("/(>)\s*(<)/i", "$1$2", $text);

    // Allow <br> and <tr> tags, strip all others
    $text = strip_tags($text, '<br><tr><ul><li><em><strong>');

    // Replace <br> with "  \n"
    $text = preg_replace("/<br\s*\/?>/i", "  \n", $text);

    // Replace <tr> and </tr> with "  \n"
    $text = preg_replace("/<tr[^>]*>/i", "  \n", $text);
    $text = preg_replace("/<\/tr[^>]*>/i", "  \n", $text);

    // Replace <ul> and </ul> with "  \n"
    $text = preg_replace("/<\/?ul>/i", "  \n", $text);

    // Replace <li> with "- " and </li> with "\n"
    $text = preg_replace("/<li>/i", "- ", $text);
    $text = preg_replace("/<\/li>/i", "\n", $text);

    // Replace <em> and </em> with "*"
    $text = preg_replace("/<\/?em>/i", "*", $text);

    // Replace <strong> and </strong> with "**"
    $text = preg_replace("/<\/?strong>/i", "**", $text);

    // Prevent excessive line breaks by replacing three or more with just two
    $text = preg_replace("/(  \n){3,}/i", "  \n  \n", $text);

    // Convert Unicode characters represented as \uXXXX to UTF-8
    $text = preg_replace_callback(
        '/\\\\u([0-9a-fA-F]{4})/',
        fn($matches) => mb_convert_encoding(pack('H*', $matches[1]), 'UTF-8', 'UTF-16BE'),
        $text
    );

    return $text;
	}
}
